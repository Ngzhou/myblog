---
title: 编码哪些事儿
comments: false
date: 2019-07-26 10:58:28
tags:
- js
updated:
categories:
- WEB前端
author: jun.zhou
---

# 1 编码的发展历史
## 1.1 几个概念
### 什么是字符

字符是一个信息单位，在计算机里面，一个中文汉字、一个英文字母、一个阿拉伯数字、一个标点符号都是一个字符。

### 什么是字库表

一些字符放在一起形成的一个数据库。例如英语、汉语等所包含的所有字符。

### 什么是编码字符集（字符集）

在一个字库表中，每一个字符都有一个对应的二进制地址，而编码字符集就是这些地址的集合。通过对应关系可以实现字符和二进制数之间的转换。例如在ASCII码字符集中，字母A的序号（地址）是65，65的二进制就是01000001。

### 什么是字符编码

字符编码也称字集码，是把字符集中的字符编码为特定的二进制数，以便文本在计算机中存储和通过通信网络的传递。要完成编码需要三个关键元素：字库表、编码字符集、字符编码。字库表相当于所有字符的数据库，字库表决定了整个字符集的范围。编码字符集，即用一个编码值来表示一个字符在字库中的位置。字符编码，将编码字符集和实际存储数值之间的转换关系。用函数y=f(x)来表示，

                          编码：二进制数字=字符编码（字符）

                          解码：字符=字符编码（二进制数字）

## 1.2 ASCII字符集
常见字符集名称：ASCII字符集、GB2312字符集、BIG5字符集、GB18030字符集、Unicode字符集等。计算机要准确的处理各种字符集文字，需要进行字符编码，以便计算机能够识别和存储各种文字。
### ASCII 码
我们知道，计算机内部，所有信息最终都是一个二进制值。每一个二进制位（bit）有0和1两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个字节（byte）。也就是说，一个字节一共可以用来表示256种不同的状态，每一个状态对应一个符号，就是256个符号，从00000000到11111111。

ASCII 码一共规定了128个字符的编码，比如空格SPACE是32（二进制00100000），大写的字母A是65（二进制01000001）。这128个符号（包括32个不能打印出来的控制符号），只占用了一个字节的后面7位，最前面的一位统一规定为0。
![Ascii](https://img.fengjr.com/image/2019/07/26/74fab5831e99f021927d1ed058254f0f.png "Ascii")
## 1.3 ASCII扩展
英语用128个符号编码就够了，但是用来表示其他语言，128个符号是不够的,当计算机传到了欧洲，一些欧洲国家就决定，利用字节中闲置的最高位编入新的符号。

后来国际标准化组织在ASCII的基础上进行了扩展，形成了ISO-8859标准，兼容ASCII，在高128个码位上有所区别。但是由于欧洲的语言环境十分复杂，所以根据各地区的语言又形成了很多子标准，ISO-8859-1、ISO-8859-2、ISO-8859-3、……、ISO-8859-16。
## 1.4 GB2312
对于亚洲国家的文字，使用的符号就更多了，汉字就多达10万左右。一个字节只能表示256种符号，肯定是不够的，就必须使用多个字节表达一个符号。

简体中文常见的编码方式是 GB2312，使用两个字节表示一个汉字，所以理论上最多可以表示 256 x 256 = 65536 个符号。

1981年5月1日开始实施的一套国家标准，标准号是GB 2312—1980

基本集共收入汉字6763个和非汉字图形字符682个。整个字符集分成94个区，每区有94个位。每个区位上只有一个字符，因此可用所在的区和位来对汉字进行编码，称为区位码。
![图](https://img.fengjr.com/image/2019/07/26/367a26051ab559f4057fa4ba682e88a9.jpg "图")
## 1.5 BIG5
又称大五码或五大码，1984年由台湾财团法人信息工业策进会和五家软件公司宏碁 (Acer)、神通 (MiTAC)、佳佳、零壹 (Zero One)、大众 (FIC)创立，故称大五码。

Big5字符集共收录13,053个中文字，该字符集在中国台湾使用。
## 1.6 GBK
GBK编码，是对GB2312编码的扩展，因此完全兼容GB2312-80标准。GBK编码依然采用双字节编码方案，其编码范围：8140－FEFE，剔除xx7F码位，共23940个码位。共收录汉字和图形符号21886个，其中汉字（包括部首和构件）21003个，图形符号883个。

      注： 0x7F表示删除符号，各种编码规范都应避开。

GBK编码支持国际标准ISO/IEC10646-1和国家标准GB13000-1中的全部中日韩汉字，并包含了BIG5编码中的所有汉字。GBK编码方案于1995年12月15日正式发布。
## 1.7 Unicode
世界上存在着多种编码方式，同一个二进制数字可以被解释成不同的符号。要想打开一个文件，就必须知道编码方式，否则只能看到乱码。

国际标准化组织(ISO)编纂了ISO10646来规范和整合字符集(被成为通用字符集 Universal Character Set，UCS )。统一码联盟(由各个大型企业及组织共同维护)发布了统一码(Unicode)项目。

起初，UCS和Unicode各自为政，但1991年前后他们都发现：世界不需要两个不一样的“统一”、“通用”的字符集。所以他们联合起来维护一个字符集，现在他们的差别大概是发布新版本时使用什么字体。

UCS和Unicode都使用最大32bit来存储字符，理论上可以表示42亿个字符，实际码位(字符数)只有1114112个，从0x00到0x10FFFF。
目前的Unicode字符分为17组编排，0x000000 至 0x10FFFF，每组称为平面（Plane），而每平面拥有65536个码位，目前只用了少数平面。

零号平面( BMP)，0x0000-0xFFFF，共定义27973个汉字，范围0x4E00-0x9FA5。平面2中有43253个汉字。例如汉字的“汉”字，编码为0x6C49。
## 1.8 UTF8
使用32bit来存储字符看起来是一件一劳永逸的方式，但如果这32bit是定宽的(即任何字符都要使用完这32bit)的话就不可避免的造成空间的浪费，程序效率也会降低！

能不能把UCS(Unicode)设计成“变宽”的呢？聪明的设计师想到了一个主意，他们发明了一种名为“统一码转换格式”即UTF来将字符对应的数字转化为多个字节来进行存储。

Unicode是编码字符集，而UTF-8就是字符编码，即Unicode规则字库的一种实现形式。常见的编码实现还有UTF-16、UTF-32。

UTF-8是可变长度字符编码。编码规则如下：
![图](https://img.fengjr.com/image/2019/07/26/2f3d1d3592ec94f1de0d05d10cf46321.jpg "图")

“汉”字的Unicode编码是0x6C49。0x6C49在0x0800-0xFFFF之间，使用3字节模板：1110xxxx 10xxxxxx 10xxxxxx。
![图](https://img.fengjr.com/image/2019/07/26/8623511c7cf0e4a09c08cda5752157aa.jpg "图")
## 1.9 UTF-16和UTF-32
 ![图](https://img.fengjr.com/image/2019/07/26/ebadcf8a655996c3dc908b5a1a97ddda.jpg "图")
## 1.10 Emoji
所谓Emoji（表情符号）就是一种在Unicode位于\u01F601-\u01F64F区段的字符。

MYSQL中utf8只支持3个字节，即实现了0平面的编码范围\u0000-\uFFFF，utf8mb4是支持4个字节的，兼容utf8，因此mysql数据库中一定要用utfmb4编码。
# 2 计算机文件
计算机文件（或称文件、电脑档案、档案），是存储在某种长期储存设备上的一段数据流。所谓“长期储存设备”一般指磁盘、光盘、磁带等。其特点是所存信息可以长期、多次使用，不会因为断电而消失。

一种重要的文件是文本文件，是由一些字符的串行组成的。二进制文件一般是指除了文本文件以外的文件。

虽然一个文件表现为一个单一的流，但它经常在磁盘不同的位置存储为多个数据碎片（甚至是多个磁盘）。操作系统会将它们组织成文件系统，每个文件放在特定的文件夹或目录中。
## 2.1 文本文件
文本文件是一种计算机文件，它是一种典型的顺序文件，其文件的逻辑结构又属于流式文件。

文本文件存在于计算机文件系统中。通常，通过在文本文件最后一行后放置文件结束标志来指明文件的结束。计算机的存储在物理上是二进制的，所以文本文件与二进制文件的区别并不是物理上的，而是逻辑上的。这两者只是在编码层次上有差异。

简单来说，文本文件是基于字符编码的文件，常见的编码有ASCII编码，UNICODE编码等等。二进制文件是基于值编码的文件，你可以根据具体应用，指定某个值（可以看作是自定义编码）。
 ![](https://img.fengjr.com/image/2019/07/26/1c98a752254d31b3c34ca663e0c762f5.png "图")
## 2.2 二进制文件
![图](https://img.fengjr.com/image/2019/07/26/11b6841f8c002ba6dc52a7e213db7cbf.jpg "图")
## 2.3 比较
![](https://img.fengjr.com/image/2019/07/26/b1fdd2a20f97914c497c0801b736d374.jpg "图")

# 3 数据传输中的编码
通常上的理解，http协议中请求、响应都是以ASCII字符方式传输，如果要传输二进制需要经过BASE64或MIME等编码（因为HTTP协议pop3、smtp邮件协议都是针对文本的，而FTP支持传输二进制数据）

如果直接使用http传输二进制(不经过base64编码)，可能会造成一下问题：

 1) 不知道传输字节的具体长度。如将int类型的1234567转为char类型“1234567”，丢失掉了长度的信息，本来只有4个字节，但是转化成文本的是有7个字节，无法转换回去。

 2) 对于一些数字，二进制传输Server是没法处理的。如int 1,二进制数据是0x00000001，按字节传输的时候，client能够正常发送，但是libevent收到以后，在抛给libevent_http层时，会把数据截断，前两位0x00是字符串的停止符。

HTTP请求体可以是多种形式的。根据请求头/响应头中的content-type属性来处理。例如 Content-Type:image/gif 说明传输的是一个image对象（二进制数据），该对象为gif格式。
## 3.1 Base64
base64 最早就是用来邮件传输协议中的，原因是邮件传输协议只支持 ascii 字符传递，因此如果要传输二进制文件，如：图片、视频是无法实现的。因此 base64 就可以用来将二进制文件内容编码为只包含 ascii 字符的内容。

Base64常用于X.509公钥证书、 XML文本传输、 HTTP协议、电子邮件（SMTP协议）、图片base64编码。

Base64编码之所以称为Base64，是因为其使用64个字符来对任意数据进行编码，同理有Base32、Base16编码。

Base64的原理很简单，首先，准备一个包含64个字符的数组：
['A', 'B', 'C', ... 'a', 'b', 'c', ... '0', '1', ... '+', '/’]
然后，对二进制数据进行处理，每3个字节一组，一共是3x8=24bit，划为4组，每组正好6个bit：
![](https://img.fengjr.com/image/2019/07/26/762449f589daeec232f87ee37cac66ba.png "图")
![](https://img.fengjr.com/image/2019/07/26/bb7aa5be3384b28432e4bd178edf00a6.png "图")
## 3.2 URL编码
![](https://img.fengjr.com/image/2019/07/26/5461599f6a44163821d2bd0e1b60307b.png "图")
![](https://img.fengjr.com/image/2019/07/26/de1bc5942fcbde2867eac9ec1dd913c8.png "图")
![](https://img.fengjr.com/image/2019/07/26/f2a00f22bf4b2506ec83a25b7730d808.png "图")





